<%+header%>

<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">//<![CDATA[
	XHR.poll(15, '<%=luci.dispatcher.build_url("admin", "network", "mwan3", "tshoot")%>', null,
		function(x, st)
		{
			var tx = document.getElementById('mwan3_tshoot_text');
			if (tx)
			{
				if (st && st.iprule)
				{
					var temp = '';
					var firewalldef = '<br />Firewall default output policy (must be ACCEPT) :<br />';
					var iproute = 'Output of &#34;ip route show&#34; :<br />';
					var iprulesh = 'Output of &#34;ip rule show&#34; :<br />';
					var routelisttbl = 'Output of &#34;ip route list table 1001-1027&#34; :<br />';
					var iptable = 'Output of &#34;iptables -L -t mangle -v -n | awk &#39;/mwan3/&#39; RS=&#34; :<br />';
					var ifcnfg = 'Output of &#34;ifconfig&#34; :<br />';
					var mwan3cnfg = 'Output of &#34;cat /etc/config/mwan3&#34; :<br />';
					var netcnfg = 'Output of &#34;cat /etc/config/network&#34; :<br />';

					temp = String.format(
						'<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s<span class="tsht">%s</span>%s',
							firewalldef, st.fidef[0].firedef, iproute, st.rtshow[0].iprtshow, iprulesh, st.iprule[0].rule, routelisttbl, st.routelist[0].iprtlist, iptable, st.iptables[0].iptbls, ifcnfg, st.ifconfig[0].ifcfg, mwan3cnfg, st.mwan3config[0].mwn3cfg, netcnfg, st.netconfig[0].netcfg
					);
					tx.innerHTML = temp;
				}
				else
				{
					tx.innerHTML = '';
				}
			}
		}
	);
//]]></script>

<style type="text/css">
	.tsht { background-color: rgb(78, 186, 241); }
</style>

<fieldset class="cbi-section">
	<legend><%:MWAN3 Multi-WAN troubleshooting%></legend>
	<div id="mwan3_tshoot_text" style="text-align:left; white-space:pre"><em><%:Collecting data...%></em></div>
</fieldset>

<%+footer%>
